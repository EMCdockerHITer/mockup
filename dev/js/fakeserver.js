require(["sinon","jquery"],function(a,b){function c(a,b){var c=a.split("?")[1];if(void 0===c)return null;for(var d=c.split("&"),e=0;e<d.length;e+=1){var f=d[e].split("=");if(decodeURIComponent(f[0])==b)return decodeURIComponent(f[1])}return null}var d=a.fakeServer.create();return d.autoRespond=!0,d.autoRespondAfter=200,d.respondWith("GET",/search.json/,function(a){var b=[{UID:"123sdfasdf",getURL:"http://localhost:8081/news/aggregator",Type:"Collection",Description:"Site News",Title:"News"},{UID:"fooasdfasdf1123asZ",getURL:"http://localhost:8081/news/aggregator",Type:"Collection",Description:"Site News",Title:"Another Item"},{UID:"fooasdfasdf1231as",getURL:"http://localhost:8081/news/aggregator",Type:"Collection",Description:"Site News",Title:"News"},{UID:"fooasdfasdf12231451",getURL:"http://localhost:8081/news/aggregator",Type:"Collection",Description:"Site News",Title:"Another Item"},{UID:"fooasdfasdf1235dsd",getURL:"http://localhost:8081/news/aggregator",Type:"Collection",Description:"Site News",Title:"News"},{UID:"fooasdfasd345345f",getURL:"http://localhost:8081/news/aggregator",Type:"Collection",Description:"Site News",Title:"Another Item"},{UID:"fooasdfasdf465",getURL:"http://localhost:8081/news/aggregator",Type:"Collection",Description:"Site News",Title:"News"},{UID:"fooaewrwsdfasdf",getURL:"http://localhost:8081/news/aggregator",Type:"Collection",Description:"Site News",Title:"Another Item"},{UID:"fooasdfasd123f",getURL:"http://localhost:8081/news/aggregator",Type:"Collection",Description:"Site News",Title:"News"},{UID:"fooasdfasdas123f",getURL:"http://localhost:8081/news/aggregator",Type:"Collection",Description:"Site News",Title:"Another Item"},{UID:"fooasdfasdfsdf",getURL:"http://localhost:8081/news/aggregator",Type:"Collection",Description:"Site News",Title:"News"},{UID:"fooasdfasdf",getURL:"http://localhost:8081/news/aggregator",Type:"Collection",Description:"Site News",Title:"Another Item"}],d=[],e=JSON.parse(c(a.url,"batch")),f=JSON.parse(c(a.url,"query"));if("none*"===f.criteria[0].v)d=[];else if(e){var g,h;g=(e.page-1)*e.size,h=g+e.size,d=b.slice(g,h)}a.respond(200,{"Content-Type":"application/json"},JSON.stringify({total:d.length,results:d}))}),d.respondWith(/relateditems-test.json/,function(a){function d(a,b){return k=[],void 0===b?i:(_.each(a,function(a){var c,d=(a.UID+" "+a.Title+" "+a.path+" "+a.Type).toLowerCase();if("object"==typeof b){for(var e=0;e<b.length;e++)if(c=b[e].toLowerCase(),d.indexOf(c)>-1){k.push(a);break}}else c=b.toLowerCase(),d.indexOf(c)>-1&&k.push(a)}),void 0)}function e(a,b,c){k=[];var e=c.substring(0,c.length-1),f=e.split("/"),g=[];return _.each(a,function(a){var b=a.path.split("/");0===a.path.indexOf(e)&&b.length-1==f.length&&g.push(a)}),void 0===b?g:(d(g,b),void 0)}var f=[{UID:"jasdlfdlkdkjasdf",Title:"Some Image",path:"/test.png",Type:"Image"},{UID:"asdlfkjasdlfkjasdf",Title:"News",path:"/news",Type:"Folder"},{UID:"124asdfasasdaf34",Title:"About",path:"/about",Type:"Folder"},{UID:"asdf1234",Title:"Projects",path:"/projects",Type:"Folder"},{UID:"asdf1234gsad",Title:"Contact",path:"/contact",Type:"Document"},{UID:"asdv34sdfs",Title:"Privacy Policy",path:"/policy",Type:"Document"},{UID:"asdfasdf234sdf",Title:"Our Process",path:"/our-process",Type:"Folder"},{UID:"asdhsfghyt45",Title:"Donate",path:"/donate-now",Type:"Document"}],g=[{UID:"gfn5634f",Title:"About Us",path:"/about/about-us",Type:"Document"},{UID:"45dsfgsdcd",Title:"Philosophy",path:"/about/philosophy",Type:"Document"},{UID:"dfgsdfgj675",Title:"Staff",path:"/about/staff",Type:"Folder"},{UID:"sdfbsfdh345",Title:"Board of Directors",path:"/about/board-of-directors",Type:"Document"}],h=[{UID:"asdfasdf9sdf",Title:"Mike",path:"/about/staff/mike",Type:"Document"},{UID:"cvbcvb82345",Title:"Joe",path:"/about/staff/joe",Type:"Document"}],i=g.concat(f).concat(h),j=function(a){for(var b=0;b<a.length;b+=1){var c=a[b];c.getURL=window.location.origin+c.path}};j(i),j(f),f[0].getURL=window.location.origin+"/exampledata/test.png";var k=[],l=c(a.url,"batch"),m=1,n=10;l&&(l=b.parseJSON(l),m=l.page,n=l.size),m-=1;var o=c(a.url,"query"),p=null,q="";o&&(o=b.parseJSON(o),q=o.criteria[0].v,o.criteria.length>1&&(p=o.criteria[1].v)),p?e(i,q,p):d(i,q),a.respond(200,{"Content-Type":"application/json"},JSON.stringify({total:k.length,results:k.slice(m*n,m*n+(n-1))}))}),d.respondWith("GET",/something.html/,[200,{"Content-Type":"text/html"},'    <html>     <head></head>    <body>     <div id="content">    <h1>Content from AJAX</h1>    <p>Ah, it is a rock, though. Should beat everything.</p>    </body>     </html>']),d.respondWith("GET",/something-link.html/,[200,{"Content-Type":"text/html"},'    <html>     <head></head>    <body>     <div id="content">    <h1>Content from AJAX with a link</h1>    <p>Ah, it is a rock, though. Should beat <a href="something-else.html">link</a> everything.</p>    </body>     </html>']),d.respondWith("GET",/something-else.html/,[200,{"Content-Type":"text/html"},'    <html>     <head></head>    <body>     <div id="content">    <h1>Something else</h1>    <p>We loaded a link.</p>    </body>     </html>']),d.respondWith("POST",/upload/,function(a){a.respond(200,{"content-Type":"application/json"},JSON.stringify({url:"http://localhost:8000/blah.png",uid:"sldlfkjsldkjlskdjf",name:"blah.png",filename:"blah.png",type:"Image",size:239292}))}),d.respondWith("GET",/portal_factory\/@@querybuilder_html_results/,function(a){var c=b("#querystring-example-results").text();a.respond(200,{"content-Type":"text/html"},c)}),d.respondWith("GET",/portal_factory\/@@querybuildernumberofresults/,function(a){var c=b("#querystring-number-results-example-results").text();a.respond(200,{"content-Type":"text/html"},c)}),d});