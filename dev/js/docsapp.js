define(["jquery","underscore","backbone","mockup-registry"],function(a,b,c,d){var e=c.Model.extend({defaults:{title:"",description:""},initialize:function(){this.set("content",this.getContent())},getContent:function(){return a("#page_"+this.get("id")).html()}}),f=c.Collection.extend({model:e,comparater:function(a){return a.get("title")}}),g=c.View.extend({initialize:function(){this.exampleClass="example-"+this.model.get("id"),this.$examples=a("script."+this.exampleClass)},renderExamples:function(){var c=a("#tpl_example").html(),d="";return examples=this.buildExamples(),b.each(examples,function(a){d+=b.template(c,a)},this),d},buildExamples:function(){var c=this,d=[];return c.$examples.each(function(){var c={title:""};c.html=a(this).html(),c.pre=b.escape(c.html),void 0!==a(this).data().title&&(c.title=a(this).data().title),d.push(c)}),d},render:function(){var c=this,e=a("#tpl_pattern").html();return require(["mockup-patterns-"+c.model.get("id")],function(){c.$el.html(b.template(e,b.extend({examples:c.renderExamples()},c.model.toJSON()))),d.scan(c.$el)}),this}}),h=c.View.extend({className:"media",tpl:a("#tpl_patterns_list_item").html(),render:function(){return this.$el.html(b.template(this.tpl,this.model.toJSON())),this}}),i=c.View.extend({className:"docs-patterns",tpl:a("#tpl_patterns_list").html(),children:[],render:function(){return this.$el.html(b.template(this.tpl,{})),b.each(this.model.models,function(a){var b=new h({model:a});this.children.push(b),this.$el.append(b.render().$el)},this),this},remove:function(){b.each(this.children,function(a){a.remove()}),c.View.prototype.remove.apply(this)}}),j=c.View.extend({render:function(){var c=this,e=a("#tpl_page").html(),f=c.model.toJSON(),g=[];return a.isArray(f.requiredPatterns)&&f.requiredPatterns.length>0&&a.each(f.requiredPatterns,function(a,b){g.push("mockup-patterns-"+b)}),require(g,function(){c.$el.html(b.template(e,f)),d.scan(c.$el)}),this}});App={patterns:new f,pages:new f,initialize:function(){return this.detectUrl(),c.history.start({pushState:!1,root:App.urlRoot}),App},show:function(b){void 0!==this.view&&(this.view.remove(),delete this.view),this.view=b,a("#content").html(this.view.render().$el)},detectUrl:function(){var a=window.location.pathname.split("/"),c="";this.urlRoot||(b.each(a,function(b,d){d<a.length-1&&(c+=b+"/")}),this.urlRoot=c+"index.html")}};var k=c.Router.extend({routes:{"patterns/(:id)":"pattern",patterns:"patterns","":"patterns",":id":"page"},patterns:function(){var a=new i({model:App.patterns});App.show(a)},page:function(a){this.resolve("page",App.pages,a)},pattern:function(a){this.resolve("pattern",App.patterns,a)},resolve:function(a,b,c){var d;d=c?c:"";var e=b.get(d);if(e){var f;f="page"===a?new j({model:e}):new g({model:e}),App.show(f)}}});return b.extend(App,c.Events),App.router=new k,App});