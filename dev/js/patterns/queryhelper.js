define(["jquery","mockup-patterns-base"],function(a,b){"use strict";var c=b.extend({name:"queryhelper",defaults:{basePattern:null,ajaxvocabulary:null,searchParam:"SearchableText",attributes:["UID","Title","Description","getURL","Type"],batchSize:10,baseCriteria:[]},init:function(){var a=this;a.basePattern=a.options.basePattern,void 0===a.basePattern&&(a.basePattern={browsing:!1}),a.options.url&&!a.options.ajaxvocabulary&&(a.options.ajaxvocabulary=a.options.url),a.valid=void 0!==a.options.ajaxvocabulary&&null!==a.options.ajaxvocabulary?!0:!1},selectAjax:function(){var a=this;return{url:a.options.ajaxvocabulary,dataType:"JSON",quietMillis:100,data:function(b,c){b&&(b+="*");var d=a.options.baseCriteria.slice(0);d.push({i:a.options.searchParam,o:"plone.app.querystring.operation.string.contains",v:b});var e=a.basePattern;e.browsing&&d.push({i:"path",o:"plone.app.querystring.operation.string.path",v:e.currentPath?e.currentPath:e.options.basePath});var f={query:JSON.stringify({criteria:d}),batch:JSON.stringify({page:c,size:a.options.batchSize}),attributes:JSON.stringify(a.options.attributes)};return f},results:function(a,b){var c=10*b<a.total;return{results:a.results,more:c}}}},search:function(b,c,d,e,f){void 0===f&&(f=!0);var g=this,h=[];f&&(h=g.options.baseCriteria.slice(0)),h.push({i:b,o:c,v:d});var i={query:JSON.stringify({criteria:h}),attributes:JSON.stringify(g.options.attributes)};a.ajax({url:g.options.ajaxvocabulary,dataType:"JSON",data:i,success:e})}});return c});