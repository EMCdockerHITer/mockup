define(["jquery","mockup-patterns-base"],function(a,b){"use strict";var c=b.extend({name:"queryhelper",defaults:{basePattern:null,vocabularyUrl:null,searchParam:"SearchableText",attributes:["UID","Title","Description","getURL","Type"],batchSize:10,baseCriteria:[],pathDepth:1},init:function(){var a=this;a.basePattern=a.options.basePattern,void 0===a.basePattern&&(a.basePattern={browsing:!1,basePath:"/"}),a.options.url&&!a.options.vocabularyUrl&&(a.options.vocabularyUrl=a.options.url),a.valid=void 0!==a.options.vocabularyUrl&&null!==a.options.vocabularyUrl?!0:!1},getCurrentPath:function(){var a,b=this,c=b.basePattern;a=b.currentPath?b.currentPath:c.currentPath,"function"==typeof a&&(a=a());var d=a;return d||(d=c.options.basePath?c.options.basePath:"/"),d},getCriterias:function(b,c){void 0===c&&(c={}),c=a.extend({},{useBaseCriteria:!0,additionalCriterias:[]},c);var d=this,e=[];c.useBaseCriteria&&(e=d.options.baseCriteria.slice(0)),b&&(b+="*",e.push({i:d.options.searchParam,o:"plone.app.querystring.operation.string.contains",v:b}));var f=d.basePattern;return f.browsing&&e.push({i:"path",o:"plone.app.querystring.operation.string.path",v:d.getCurrentPath()+"::"+d.options.pathDepth}),e=e.concat(c.additionalCriterias)},getBatch:function(a){a||(a=1);var b=this;return{page:a,size:b.options.batchSize}},selectAjax:function(){var a=this;return{url:a.options.vocabularyUrl,dataType:"JSON",quietMillis:100,data:function(b,c){var d={query:JSON.stringify({criteria:a.getCriterias(b)}),batch:JSON.stringify(a.getBatch(c)),attributes:JSON.stringify(a.options.attributes)};return d},results:function(a,b){var c=10*b<a.total;return{results:a.results,more:c}}}},search:function(b,c,d,e,f){void 0===f&&(f=!0);var g=this,h=[];f&&(h=g.options.baseCriteria.slice(0)),h.push({i:b,o:c,v:d});var i={query:JSON.stringify({criteria:h}),attributes:JSON.stringify(g.options.attributes)};a.ajax({url:g.options.vocabularyUrl,dataType:"JSON",data:i,success:e})}});return c});