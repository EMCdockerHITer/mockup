define(["jquery","mockup-patterns-base"],function(a,b){"use strict";var c=b.extend({name:"picture",defaults:{alt:null,klass:{loading:"picture-loading",error:"picture-error"},attribute:{src:"data-src",media:"data-media"}},init:function(){var b,d=this;void 0===c.__queue_picture_patterns&&(c.__queue_picture_patterns=[],a(window).on("queue.picture.patterns",function(){a(".pat-picture").length===c.__queue_picture_patterns.length&&(a.each(c.__queue_picture_patterns,function(a,b){b.display()}),c.__queue_picture_patterns=[])})),b=function(a){var b=a.data.context;b.queue()},a(window).on("resize",{context:d},b),d.queue()},queue:function(){var a=this;a.visible()?c.__queue_picture_patterns.unshift(a):c.__queue_picture_patterns.push(a),a.trigger("queue")},display:function(){var b=this,c=[],d=a("img",b.$el);a("["+b.options.attribute.src+"]",b.$el).each(function(){var d=a(this);(!d.attr(b.options.attribute.media)||b.matchMedia(d.attr(b.options.attribute.media)))&&c.push(d)}),c.length&&(d.length||(d=a("<img />").attr("alt",b.options.alt),b.$el.append(d)),d.load(function(){b.$el.removeClass(b.options.klass.loading),b.trigger("complete")}).error(function(){b.$el.addClass(b.options.klass.error),b.trigger("error")}),b.$el.addClass(b.options.klass.loading),d.attr("src",c.pop().attr(b.options.attribute.src)),b.trigger("loading"))},visible:function(){var b=this,c=a(window).scrollTop(),d=c+a(window).height(),e=b.$el.offset().top,f=e+b.$el.height();return f>=c&&d>=e},matchMedia:function(a){var b,c=document.documentElement,d=c.firstElementChild||c.firstChild,e=document.createElement("body"),f=document.createElement("div");return f.id="mq-test-1",f.style.cssText="position:absolute;top:-100em",e.style.background="none",e.appendChild(f),f.innerHTML='&shy;<style media="'+a+'"> #mq-test-1 { width: 42px; }</style>',c.insertBefore(e,d),b=42===f.offsetWidth,c.removeChild(e),b}});return c});